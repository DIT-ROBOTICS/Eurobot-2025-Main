<?xml version="1.0" encoding="UTF-8"?>
<root BTCPP_format="4">
  <BehaviorTree ID="BannerMission">
    <Sequence>
      <Fallback>
        <Docking final_pose="{PrevGoal}"
                 isPureDocking="0"
                 dock_type="mission_dock_y"
                 offset="-0.1"
                 base="0.75, 0.4, 2"
                 _description="go to place the banner"/>
        <Docking final_pose="{PrevGoal}"
                 isPureDocking="0"
                 dock_type="mission_dock_y"
                 offset="-0.1"
                 base="1.25, 0.4, 2"/>
        <Docking final_pose="{PrevGoal}"
                 isPureDocking="0"
                 dock_type="mission_dock_y"
                 offset="-0.1"
                 base="2.75, 0.4, 2"/>
      </Fallback>
      <Fallback>
        <Sleep msec="4000"/>
        <Switch2 case_1="1"
                 case_2="2"
                 variable="1">
          <Sleep msec="4000"/>
          <Sleep msec="4000"/>
        </Switch2>
      </Fallback>
    </Sequence>
  </BehaviorTree>

  <BehaviorTree ID="FuncTest">
    <Sequence>
      <Docking final_pose="{PrevGoal}"
               isPureDocking="1"
               dock_type="mission_dock_x"
               offset="0.1"
               base="1.6, 1.3, 0"/>
      <SubTree ID="PortRemapTest"
               DOCK_TYPE="mission_dock_x"
               DOCK_DIST="0.3"
               _autoremap="true"/>
    </Sequence>
  </BehaviorTree>

  <BehaviorTree ID="MainTree">
    <Sequence>
      <Sequence>
        <BTStarter result="{STATUS}"/>
        <CamReceiver/>
      </Sequence>
      <ForceSuccess>
        <SubTree ID="MissionPointOne"
                 _autoremap="true"/>
      </ForceSuccess>
      <ForceSuccess>
        <SubTree ID="MissionPointThree"
                 _autoremap="true"/>
      </ForceSuccess>
      <ForceSuccess>
        <SubTree ID="MissionPointFour"
                 _autoremap="true"/>
      </ForceSuccess>
      <Docking final_pose="{PrevGoal}"
               isPureDocking="0"
               dock_type="mission_dock_y"
               offset="0.1"
               base="0.35, 1.6, 3"/>
    </Sequence>
  </BehaviorTree>

  <BehaviorTree ID="MissionPointFour">
    <Sequence>
      <RetryUntilSuccessful num_attempts="3">
        <Docking final_pose="{PrevGoal}"
                 isPureDocking="0"
                 dock_type="mission_dock_y"
                 offset="-0.1"
                 base="0.8, 0.6, 1"/>
      </RetryUntilSuccessful>
      <Sleep msec="500"
             _description="take the raw material"/>
      <RetryUntilSuccessful num_attempts="3">
        <Docking final_pose="{PrevGoal}"
                 isPureDocking="0"
                 dock_type="mission_dock_y"
                 offset="-0.1"
                 base="0.8, 0.45, 1"
                 _description="go back to do the mission"/>
      </RetryUntilSuccessful>
      <SubTree ID="PutTwoLevels"
               DOCK_DIR="mission_dock_y"
               DOCK_FORWARD="-0.1"
               DOCK_BACKWARD="0.1"
               _autoremap="true"/>
    </Sequence>
  </BehaviorTree>

  <BehaviorTree ID="MissionPointOne">
    <Sequence>
      <Fallback>
        <Docking final_pose="{PrevGoal}"
                 isPureDocking="0"
                 dock_type="mission_dock_x"
                 offset="0.1"
                 base="2.45, 1.3, 2"/>
        <Sequence>
          <Sleep msec="100"/>
          <Navigation final_pose="{PrevGoal}"
                      type="0"
                      goal="2.55, 1.3, 2"/>
        </Sequence>
      </Fallback>
      <Sleep msec="500"
             _description="take the raw material"/>
      <Fallback>
        <Docking final_pose="{PrevGoal}"
                 isPureDocking="0"
                 dock_type="mission_dock_x"
                 offset="0.1"
                 base="2.45, 0.4, 0"/>
        <Sequence>
          <Sleep msec="100"/>
          <Navigation final_pose="{PrevGoal}"
                      type="0"
                      goal="2.55, 0.4, 0"/>
        </Sequence>
      </Fallback>
      <Sleep msec="500"
             _description="take one level (2 board &amp; 2 column)"/>
      <Fallback _description="go to the placement area">
        <Docking final_pose="{PrevGoal}"
                 isPureDocking="0"
                 dock_type="mission_dock_x"
                 offset="0.1"
                 base="2.45, 0.9, 0"/>
        <Sequence>
          <Sleep msec="100"/>
          <Navigation final_pose="{PrevGoal}"
                      type="0"
                      goal="2.55, 0.9, 0"/>
        </Sequence>
      </Fallback>
      <SubTree ID="PutThreeLevels"
               DOCK_DIR="mission_dock_x"
               DOCK_FORWARD="0.1"
               DOCK_BACKWARD="-0.1"
               _autoremap="true"/>
    </Sequence>
  </BehaviorTree>

  <BehaviorTree ID="MissionPointThree">
    <Sequence>
      <Fallback>
        <Sequence>
          <RetryUntilSuccessful num_attempts="3">
            <Docking final_pose="{PrevGoal}"
                     isPureDocking="0"
                     dock_type="mission_dock_y"
                     offset="0.1"
                     base="1.9, 0.7, 3"/>
          </RetryUntilSuccessful>
          <Sleep msec="500"
                 _description="take the raw material"/>
          <RetryUntilSuccessful num_attempts="3">
            <Docking final_pose="{PrevGoal}"
                     isPureDocking="0"
                     dock_type="mission_dock_y"
                     offset="-0.1"
                     base="2.2, 0.5, 3"/>
          </RetryUntilSuccessful>
          <Sleep msec="500"
                 _description="take one level"/>
        </Sequence>
        <Sequence>
          <RetryUntilSuccessful num_attempts="3">
            <Docking final_pose="{PrevGoal}"
                     isPureDocking="0"
                     dock_type="mission_dock_y"
                     offset="0.1"
                     base="1.9, 0.7, 3"/>
          </RetryUntilSuccessful>
          <Sleep msec="500"
                 _description="take the raw material"/>
        </Sequence>
      </Fallback>
      <RetryUntilSuccessful num_attempts="3">
        <Docking final_pose="{PrevGoal}"
                 isPureDocking="0"
                 dock_type="mission_dock_y"
                 offset="-0.1"
                 base="1.25, 0.5, 3"/>
      </RetryUntilSuccessful>
      <SubTree ID="PutThreeLevels"
               DOCK_DIR="mission_dock_y"
               DOCK_FORWARD="-0.1"
               DOCK_BACKWARD="0.1"
               _autoremap="true"/>
    </Sequence>
  </BehaviorTree>

  <BehaviorTree ID="NavTest">
    <Sequence>
      <Navigation final_pose="{PrevGoal}"
                  type="0"
                  goal="1, 1, 0"/>
      <Navigation final_pose="{PrevGoal}"
                  type="0"
                  goal="1, 1, 1"/>
      <Navigation final_pose="{PrevGoal}"
                  type="0"
                  goal="1, 1, 2"/>
      <Rotation final_pose="{PrevGoal}"
                degree="90"
                base="{PrevGoal}"/>
      <Rotation final_pose="{PrevGoal}"
                degree="90"
                base="{PrevGoal}"/>
      <Rotation final_pose="{PrevGoal}"
                degree="-90"
                base="{PrevGoal}"/>
      <Rotation final_pose="{PrevGoal}"
                degree="-90"
                base="{PrevGoal}"/>
    </Sequence>
  </BehaviorTree>

  <BehaviorTree ID="PortRemapTest">
    <Sequence>
      <Docking final_pose="{PrevGoal}"
               isPureDocking="0"
               dock_type="{DOCK_TYPE}"
               offset="{DOCK_DIST}"
               base="{PrevGoal}"/>
    </Sequence>
  </BehaviorTree>

  <BehaviorTree ID="PutThreeLevels">
    <Sequence>
      <Timeout msec="1000">
        <Sleep msec="500"
               _description="place one level"/>
      </Timeout>
      <Docking final_pose="{PrevGoal}"
               isPureDocking="1"
               dock_type="{DOCK_DIR}"
               offset="{DOCK_BACKWARD}"
               base="{PrevGoal}"
               _description="step back"/>
      <Rotation final_pose="{PrevGoal}"
                degree="180"
                base="{PrevGoal}"/>
      <SubTree ID="PutTwoLevels"
               DOCK_DIR="{DOCK_DIR}"
               DOCK_FORWARD="{DOCK_FORWARD}"
               DOCK_BACKWARD="{DOCK_BACKWARD}"
               _autoremap="true"/>
      <Docking final_pose="{PrevGoal}"
               isPureDocking="1"
               dock_type="{DOCK_DIR}"
               offset="{DOCK_BACKWARD}"
               base="{PrevGoal}"
               _description="backward to free up to space for grabber to fall down"/>
      <Sleep msec="100"
             _description="fall down the grabber"/>
      <Sleep msec="100"
             _description="open the magnet"/>
      <Docking final_pose="{PrevGoal}"
               isPureDocking="1"
               dock_type="{DOCK_DIR}"
               offset="{DOCK_FORWARD}"
               base="{PrevGoal}"
               _description="forward to take two levels"/>
      <Sleep msec="1000"
             _description="lift the grabber"/>
      <Docking final_pose="{PrevGoal}"
               isPureDocking="1"
               dock_type="{DOCK_DIR}"
               offset="{DOCK_FORWARD}"
               base="{PrevGoal}"
               _description="forward to place two levels on one level"/>
      <Sleep msec="500"
             _description="turn off the magnet"/>
    </Sequence>
  </BehaviorTree>

  <BehaviorTree ID="PutTwoLevels">
    <Sequence>
      <Sleep msec="500"
             _description="put the raw material"/>
      <Docking final_pose="{PrevGoal}"
               isPureDocking="1"
               dock_type="{DOCK_DIR}"
               offset="{DOCK_BACKWARD}"
               base="{PrevGoal}"
               _description="step back"/>
      <Rotation final_pose="{PrevGoal}"
                degree="180"
                base="{PrevGoal}"
                _description="rotate to face the material"/>
      <Docking final_pose="{PrevGoal}"
               isPureDocking="1"
               dock_type="{DOCK_DIR}"
               offset="{DOCK_FORWARD}"
               base="{PrevGoal}"
               _description="docking to the material"/>
      <Sleep msec="100"
             _description="take"/>
      <Docking final_pose="{PrevGoal}"
               isPureDocking="1"
               dock_type="{DOCK_DIR}"
               offset="{DOCK_BACKWARD}"
               base="{PrevGoal}"
               _description="step back"/>
      <Sleep msec="1000"
             _description="lift"/>
      <Sleep msec="1000"
             _description="rotate the stage"/>
      <Docking final_pose="{PrevGoal}"
               isPureDocking="1"
               dock_type="{DOCK_DIR}"
               offset="{DOCK_FORWARD}"
               base="{PrevGoal}"
               _description="go forward "/>
      <Sleep msec="100"
             _description="place the stage"/>
      <Sleep msec="100"
             _description="take 1 board &amp; 2 column"/>
      <Docking final_pose="{PrevGoal}"
               isPureDocking="1"
               dock_type="{DOCK_DIR}"
               offset="{DOCK_BACKWARD}"
               base="{PrevGoal}"
               _description="step back"/>
      <Sleep msec="1000"
             _description="rotate the stage"/>
      <Docking final_pose="{PrevGoal}"
               isPureDocking="1"
               dock_type="{DOCK_DIR}"
               offset="{DOCK_FORWARD}"
               base="{PrevGoal}"
               _description="go forward"/>
      <Sleep msec="500"
             _description="place the material"/>
    </Sequence>
  </BehaviorTree>

  <!-- Description of Node Models (used by Groot) -->
  <TreeNodesModel>
    <Action ID="BTStarter">
      <output_port name="result"
                   type="int"/>
    </Action>
    <Action ID="CamReceiver"/>
    <Action ID="Docking">
      <output_port name="final_pose"
                   type="geometry_msgs::msg::PoseStamped_&lt;std::allocator&lt;void&gt; &gt;"/>
      <input_port name="isPureDocking"
                  type="bool"/>
      <input_port name="dock_type"
                  type="std::string"/>
      <input_port name="offset"
                  type="double"/>
      <input_port name="base"
                  type="geometry_msgs::msg::PoseStamped_&lt;std::allocator&lt;void&gt; &gt;"/>
    </Action>
    <Action ID="Navigation">
      <output_port name="final_pose"
                   type="geometry_msgs::msg::PoseStamped_&lt;std::allocator&lt;void&gt; &gt;"/>
      <input_port name="type"
                  type="int"/>
      <input_port name="goal"
                  type="geometry_msgs::msg::PoseStamped_&lt;std::allocator&lt;void&gt; &gt;"/>
    </Action>
    <Action ID="Rotation">
      <output_port name="final_pose"
                   type="geometry_msgs::msg::PoseStamped_&lt;std::allocator&lt;void&gt; &gt;"/>
      <input_port name="degree"
                  type="double"/>
      <input_port name="base"
                  type="geometry_msgs::msg::PoseStamped_&lt;std::allocator&lt;void&gt; &gt;"/>
    </Action>
  </TreeNodesModel>

</root>
