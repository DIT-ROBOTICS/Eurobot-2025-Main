<?xml version="1.0" encoding="UTF-8"?>
<root BTCPP_format="4">
  <BehaviorTree ID="MainTree">
    <Sequence>
      <Parallel failure_count="2"
                success_count="2">
        <Sequence>
          <Sequence>
            <BTStarter result="{STATUS}"/>
          </Sequence>
          <ForceSuccess>
            <Timeout msec="6000">
              <FirmwareMission mission_status="{x}"
                               mission_type="31"/>
            </Timeout>
          </ForceSuccess>
          <Sleep msec="1000"/>
          <Parallel failure_count="2"
                    success_count="1">
            <RetryUntilSuccessful num_attempts="2">
              <Docking final_pose="{PrevGoal}"
                       isPureDocking="0"
                       dock_type="dock_x_delaySpin"
                       shift="0"
                       offset="0"
                       base="1.2, 0.5, 1"/>
            </RetryUntilSuccessful>
            <Delay delay_msec="1000">
              <ForceSuccess>
                <Timeout msec="6000">
                  <FirmwareMission mission_status="{x}"
                                   mission_type="100"/>
                </Timeout>
              </ForceSuccess>
            </Delay>
          </Parallel>
          <ForceSuccess>
            <SubTree ID="MissionPointOne"
                     _autoremap="true"/>
          </ForceSuccess>
          <ForceSuccess>
            <SubTree ID="MissionPointTwo"
                     _autoremap="true"/>
          </ForceSuccess>
          <ForceSuccess>
            <SubTree ID="MissionPointThree"
                     _autoremap="true"/>
          </ForceSuccess>
        </Sequence>
        <Delay delay_msec="90000">
          <Sleep msec="1"/>
        </Delay>
      </Parallel>
      <Parallel failure_count="2"
                success_count="2">
        <Sequence>
          <ForceSuccess>
            <Timeout msec="5000">
              <FirmwareMission mission_status="{x}"
                               mission_type="1020"/>
            </Timeout>
          </ForceSuccess>
          <ForceSuccess>
            <Timeout msec="5000">
              <FirmwareMission mission_status="{x}"
                               mission_type="101"/>
            </Timeout>
          </ForceSuccess>
        </Sequence>
        <Docking final_pose="{PrevGoal}"
                 isPureDocking="0"
                 dock_type="dock_x_fast"
                 shift="0"
                 offset="0"
                 base="0.4, 1.5, 3"/>
      </Parallel>
    </Sequence>
  </BehaviorTree>

  <BehaviorTree ID="MissionPointOne">
    <Sequence>
      <Fallback>
        <MaterialChecker remap_offset="{offset}"
                         remap_shift="{shift}"
                         remap_dock_type="{dock_type}"
                         remap_base="{base}"
                         remap_index="{index}"
                         shift="0"
                         offset="0"
                         mission_type="front"
                         dock_type="precise_gentle"
                         base_index="6">
          <Docking final_pose="{PrevGoal}"
                   isPureDocking="0"
                   dock_type="{dock_type}"
                   shift="{shift}"
                   offset="{offset}"
                   base="{base}"/>
        </MaterialChecker>
        <MaterialChecker remap_offset="{offset}"
                         remap_shift="{shift}"
                         remap_dock_type="{dock_type}"
                         remap_base="{base}"
                         remap_index="{index}"
                         shift="0"
                         offset="-0.2"
                         mission_type="back"
                         dock_type="precise_gentle"
                         base_index="-1">
          <Docking final_pose="{PrevGoal}"
                   isPureDocking="0"
                   dock_type="{dock_type}"
                   shift="{shift}"
                   offset="{offset}"
                   base="{base}"/>
        </MaterialChecker>
        <MySetBlackboard new_value="{last_mission_failed}"
                         blackboard_value="true"
                         blackboard_key="last_mission_failed"/>
      </Fallback>
      <Parallel failure_count="2"
                success_count="2">
        <RetryUntilSuccessful num_attempts="2">
          <Docking final_pose="{PrevGoal}"
                   isPureDocking="1"
                   dock_type="dock_y_precise_gentle_slow"
                   shift="0"
                   offset="0.1"
                   base="{PrevGoal}"/>
        </RetryUntilSuccessful>
        <ForceSuccess>
          <Timeout msec="6000">
            <FirmwareMission mission_status="{x}"
                             mission_type="16"/>
          </Timeout>
        </ForceSuccess>
      </Parallel>
      <Fallback>
        <MaterialChecker remap_offset="{offset}"
                         remap_shift="{shift}"
                         remap_dock_type="{dock_type}"
                         remap_base="{base}"
                         remap_index="{index}"
                         shift="0"
                         offset="0"
                         mission_type="front"
                         dock_type="precise_gentle"
                         base_index="5">
          <Docking final_pose="{PrevGoal}"
                   isPureDocking="0"
                   dock_type="{dock_type}"
                   shift="{shift}"
                   offset="{offset}"
                   base="{base}"/>
        </MaterialChecker>
        <MaterialChecker remap_offset="{offset}"
                         remap_shift="{shift}"
                         remap_dock_type="{dock_type}"
                         remap_base="{base}"
                         remap_index="{index}"
                         shift="0"
                         offset="-0.2"
                         mission_type="back"
                         dock_type="precise_gentle"
                         base_index="-1">
          <Docking final_pose="{PrevGoal}"
                   isPureDocking="0"
                   dock_type="{dock_type}"
                   shift="{shift}"
                   offset="{offset}"
                   base="{base}"/>
        </MaterialChecker>
        <MySetBlackboard new_value="{last_mission_failed}"
                         blackboard_value="true"
                         blackboard_key="last_mission_failed"/>
      </Fallback>
      <Parallel failure_count="2"
                success_count="2">
        <ForceSuccess>
          <Timeout msec="6000">
            <FirmwareMission mission_status="{x}"
                             mission_type="26"/>
          </Timeout>
        </ForceSuccess>
        <RetryUntilSuccessful num_attempts="2">
          <Docking final_pose="{PrevGoal}"
                   isPureDocking="1"
                   dock_type="dock_y_precise_gentle_slow"
                   shift="0"
                   offset="-0.08"
                   base="{PrevGoal}"/>
        </RetryUntilSuccessful>
      </Parallel>
      <RetryUntilSuccessful num_attempts="2">
        <Docking final_pose="{PrevGoal}"
                 isPureDocking="0"
                 dock_type="dock_x_fast"
                 shift="0"
                 offset="0"
                 base="1.22, 0.315, 2"/>
      </RetryUntilSuccessful>
      <Parallel failure_count="2"
                success_count="1">
        <ForceSuccess>
          <Timeout msec="5000">
            <FirmwareMission mission_status="{x}"
                             mission_type="1327"/>
          </Timeout>
        </ForceSuccess>
        <Delay delay_msec="1000">
          <RetryUntilSuccessful num_attempts="2">
            <Docking final_pose="{PrevGoal}"
                     isPureDocking="0"
                     dock_type="dock_x"
                     shift="0"
                     offset="0"
                     base="1.0, 0.315, 2"/>
          </RetryUntilSuccessful>
        </Delay>
      </Parallel>
      <Parallel failure_count="2"
                success_count="1">
        <RetryUntilSuccessful num_attempts="2">
          <Docking final_pose="{PrevGoal}"
                   isPureDocking="0"
                   dock_type="dock_x"
                   shift="0"
                   offset="0"
                   base="1.0, 0.315, 0"/>
        </RetryUntilSuccessful>
        <Delay delay_msec="100">
          <ForceSuccess>
            <Timeout msec="5000">
              <FirmwareMission mission_status="{x}"
                               mission_type="28"/>
            </Timeout>
          </ForceSuccess>
        </Delay>
      </Parallel>
      <Delay delay_msec="300">
        <ForceSuccess>
          <Timeout msec="5000">
            <FirmwareMission mission_status="{x}"
                             mission_type="12"/>
          </Timeout>
        </ForceSuccess>
      </Delay>
      <RetryUntilSuccessful num_attempts="2">
        <Docking final_pose="{PrevGoal}"
                 isPureDocking="0"
                 dock_type="dock_x_gentle"
                 shift="0"
                 offset="0"
                 base="0.88, 0.315, 0"/>
      </RetryUntilSuccessful>
      <ForceSuccess>
        <Timeout msec="5000">
          <FirmwareMission mission_status="{x}"
                           mission_type="14"/>
        </Timeout>
      </ForceSuccess>
      <Sleep msec="1500"/>
      <RetryUntilSuccessful num_attempts="2">
        <Docking final_pose="{PrevGoal}"
                 isPureDocking="1"
                 dock_type="dock_x_gentle_slow"
                 shift="0"
                 offset="0.175"
                 base="{PrevGoal}"/>
      </RetryUntilSuccessful>
      <ForceSuccess>
        <Timeout msec="5000">
          <FirmwareMission mission_status="{x}"
                           mission_type="15"/>
        </Timeout>
      </ForceSuccess>
      <Sleep msec="1000"/>
      <RetryUntilSuccessful num_attempts="2">
        <Docking final_pose="{PrevGoal}"
                 isPureDocking="0"
                 dock_type="dock_x"
                 shift="0"
                 offset="0"
                 base="1.25, 0.315, 0"/>
      </RetryUntilSuccessful>
      <Sleep msec="500"/>
      <ForceSuccess>
        <Timeout msec="5000">
          <FirmwareMission mission_status="{x}"
                           mission_type="12"/>
        </Timeout>
      </ForceSuccess>
      <RetryUntilSuccessful num_attempts="2">
        <Docking final_pose="{PrevGoal}"
                 isPureDocking="0"
                 dock_type="dock_x"
                 shift="0"
                 offset="0"
                 base="0.9, 0.315, 0"/>
      </RetryUntilSuccessful>
      <RetryUntilSuccessful num_attempts="2">
        <Docking final_pose="{PrevGoal}"
                 isPureDocking="0"
                 dock_type="dock_x_fast"
                 shift="0"
                 offset="0"
                 base="0.9, 0.315, 2"/>
      </RetryUntilSuccessful>
      <ForceSuccess>
        <Timeout msec="5000">
          <FirmwareMission mission_status="{x}"
                           mission_type="10"/>
        </Timeout>
      </ForceSuccess>
      <RetryUntilSuccessful num_attempts="2">
        <Docking final_pose="{PrevGoal}"
                 isPureDocking="0"
                 dock_type="dock_x"
                 shift="0"
                 offset="0"
                 base="1.12, 0.315, 2"/>
      </RetryUntilSuccessful>
      <ForceSuccess>
        <Timeout msec="5000">
          <FirmwareMission mission_status="{x}"
                           mission_type="29"/>
        </Timeout>
      </ForceSuccess>
    </Sequence>
  </BehaviorTree>

  <BehaviorTree ID="MissionPointThree">
    <Sequence>
      <RetryUntilSuccessful num_attempts="2">
        <Docking final_pose="{PrevGoal}"
                 isPureDocking="0"
                 dock_type="dock_x_precise_gentle"
                 shift="0"
                 offset="0"
                 base="0.84, 0.315, 2"/>
      </RetryUntilSuccessful>
      <RetryUntilSuccessful num_attempts="2">
        <Docking final_pose="{PrevGoal}"
                 isPureDocking="1"
                 dock_type="dock_x_precise_gentle"
                 shift="0"
                 offset="0.1"
                 base="{PrevGoal}"/>
      </RetryUntilSuccessful>
      <ForceSuccess>
        <Timeout msec="5000">
          <FirmwareMission mission_status="{x}"
                           mission_type="22"/>
        </Timeout>
      </ForceSuccess>
      <Parallel failure_count="2"
                success_count="2">
        <RetryUntilSuccessful num_attempts="2">
          <Docking final_pose="{PrevGoal}"
                   isPureDocking="1"
                   dock_type="dock_x_precise_gentle"
                   shift="0"
                   offset="-0.17"
                   base="{PrevGoal}"/>
        </RetryUntilSuccessful>
        <Delay delay_msec="1000">
          <ForceSuccess>
            <Timeout msec="5000">
              <FirmwareMission mission_status="{x}"
                               mission_type="1020"/>
            </Timeout>
          </ForceSuccess>
        </Delay>
      </Parallel>
      <RetryUntilSuccessful num_attempts="2">
        <Docking final_pose="{PrevGoal}"
                 isPureDocking="0"
                 dock_type="dock_x_precise_gentle_slow_delaySpin"
                 shift="0"
                 offset="0"
                 base="0.26, 1.33, 2"/>
      </RetryUntilSuccessful>
      <Parallel failure_count="2"
                success_count="1">
        <RetryUntilSuccessful num_attempts="2">
          <Docking final_pose="{PrevGoal}"
                   isPureDocking="1"
                   dock_type="dock_x_precise_gentle_slow"
                   shift="0"
                   offset="-0.1"
                   base="{PrevGoal}"/>
        </RetryUntilSuccessful>
        <Sleep msec="500"/>
      </Parallel>
      <Parallel failure_count="2"
                success_count="1">
        <RetryUntilSuccessful num_attempts="2">
          <Docking final_pose="{PrevGoal}"
                   isPureDocking="1"
                   dock_type="dock_x_precise_gentle_slow"
                   shift="0"
                   offset="-0.1"
                   base="{PrevGoal}"/>
        </RetryUntilSuccessful>
        <ForceSuccess>
          <Timeout msec="6000">
            <FirmwareMission mission_status="{x}"
                             mission_type="16"/>
          </Timeout>
        </ForceSuccess>
      </Parallel>
      <Parallel failure_count="2"
                success_count="2">
        <Delay delay_msec="500">
          <ForceSuccess>
            <Timeout msec="6000">
              <FirmwareMission mission_status="{x}"
                               mission_type="11"/>
            </Timeout>
          </ForceSuccess>
        </Delay>
        <RetryUntilSuccessful num_attempts="2">
          <Docking final_pose="{PrevGoal}"
                   isPureDocking="0"
                   dock_type="dock_y"
                   shift="0"
                   offset="0"
                   base="0.8, 0.3, 3"/>
        </RetryUntilSuccessful>
      </Parallel>
      <Delay delay_msec="500">
        <ForceSuccess>
          <Timeout msec="6000">
            <FirmwareMission mission_status="{x}"
                             mission_type="12"/>
          </Timeout>
        </ForceSuccess>
      </Delay>
      <RetryUntilSuccessful num_attempts="2">
        <Docking final_pose="{PrevGoal}"
                 isPureDocking="1"
                 dock_type="dock_y"
                 shift="0"
                 offset="0.2"
                 base="{PrevGoal}"/>
      </RetryUntilSuccessful>
    </Sequence>
  </BehaviorTree>

  <BehaviorTree ID="MissionPointTwo">
    <Sequence>
      <Parallel failure_count="2"
                success_count="2">
        <Fallback>
          <MaterialChecker remap_offset="{offset}"
                           remap_shift="{shift}"
                           remap_dock_type="{dock_type}"
                           remap_base="{base}"
                           remap_index="{index}"
                           shift="0"
                           offset="0"
                           mission_type="front"
                           dock_type="precise"
                           base_index="7">
            <Docking final_pose="{PrevGoal}"
                     isPureDocking="0"
                     dock_type="{dock_type}"
                     shift="{shift}"
                     offset="{offset}"
                     base="{base}"/>
          </MaterialChecker>
          <MaterialChecker remap_offset="{offset}"
                           remap_shift="{shift}"
                           remap_dock_type="{dock_type}"
                           remap_base="{base}"
                           remap_index="{index}"
                           shift="0"
                           offset="-0.2"
                           mission_type="back"
                           dock_type="precise"
                           base_index="-1">
            <Docking final_pose="{PrevGoal}"
                     isPureDocking="0"
                     dock_type="{dock_type}"
                     shift="{shift}"
                     offset="{offset}"
                     base="{base}"/>
          </MaterialChecker>
          <MySetBlackboard new_value="{last_mission_failed}"
                           blackboard_value="true"
                           blackboard_key="last_mission_failed"/>
        </Fallback>
        <ForceSuccess>
          <Timeout msec="6000">
            <FirmwareMission mission_status="{x}"
                             mission_type="10"/>
          </Timeout>
        </ForceSuccess>
      </Parallel>
      <ForceSuccess>
        <Timeout msec="6000">
          <FirmwareMission mission_status="{x}"
                           mission_type="20"/>
        </Timeout>
      </ForceSuccess>
      <Parallel failure_count="2"
                success_count="1">
        <RetryUntilSuccessful num_attempts="2">
          <Docking final_pose="{PrevGoal}"
                   isPureDocking="1"
                   dock_type="dock_x_precise_gentle_slow"
                   shift="0"
                   offset="-0.08"
                   base="{PrevGoal}"/>
        </RetryUntilSuccessful>
        <Sleep msec="500"/>
      </Parallel>
      <Parallel failure_count="2"
                success_count="1">
        <RetryUntilSuccessful num_attempts="2">
          <Docking final_pose="{PrevGoal}"
                   isPureDocking="1"
                   dock_type="dock_x_precise_gentle_slow"
                   shift="0"
                   offset="-0.05"
                   base="{PrevGoal}"/>
        </RetryUntilSuccessful>
        <ForceSuccess>
          <Timeout msec="6000">
            <FirmwareMission mission_status="{x}"
                             mission_type="16"/>
          </Timeout>
        </ForceSuccess>
      </Parallel>
      <Parallel failure_count="2"
                success_count="2">
        <RetryUntilSuccessful num_attempts="2">
          <Docking final_pose="{PrevGoal}"
                   isPureDocking="0"
                   dock_type="dock_y_precise_gentle_slow_delaySpin"
                   shift="0"
                   offset="0"
                   base="0.835, 1.55, 3"/>
        </RetryUntilSuccessful>
        <ForceSuccess>
          <Timeout msec="6000">
            <FirmwareMission mission_status="{x}"
                             mission_type="13"/>
          </Timeout>
        </ForceSuccess>
      </Parallel>
      <Parallel failure_count="2"
                success_count="1">
        <RetryUntilSuccessful num_attempts="2">
          <Docking final_pose="{PrevGoal}"
                   isPureDocking="1"
                   dock_type="dock_y_precise_gentle_slow"
                   shift="0"
                   offset="0.1"
                   base="{PrevGoal}"/>
        </RetryUntilSuccessful>
        <Sleep msec="500"/>
      </Parallel>
      <Parallel failure_count="2"
                success_count="1">
        <RetryUntilSuccessful num_attempts="2">
          <Docking final_pose="{PrevGoal}"
                   isPureDocking="1"
                   dock_type="dock_y_precise_gentle_slow"
                   shift="0"
                   offset="0.05"
                   base="{PrevGoal}"/>
        </RetryUntilSuccessful>
        <ForceSuccess>
          <Timeout msec="6000">
            <FirmwareMission mission_status="{x}"
                             mission_type="26"/>
          </Timeout>
        </ForceSuccess>
      </Parallel>
      <Parallel failure_count="2"
                success_count="2">
        <Delay delay_msec="500">
          <ForceSuccess>
            <Timeout msec="6000">
              <FirmwareMission mission_status="{x}"
                               mission_type="23"/>
            </Timeout>
          </ForceSuccess>
        </Delay>
        <RetryUntilSuccessful num_attempts="2">
          <Docking final_pose="{PrevGoal}"
                   isPureDocking="0"
                   dock_type="dock_x"
                   shift="0"
                   offset="0"
                   base="0.87, 0.315, 0"/>
        </RetryUntilSuccessful>
      </Parallel>
      <ForceSuccess>
        <Timeout msec="6000">
          <FirmwareMission mission_status="{x}"
                           mission_type="12"/>
        </Timeout>
      </ForceSuccess>
      <RetryUntilSuccessful num_attempts="2">
        <Docking final_pose="{PrevGoal}"
                 isPureDocking="0"
                 dock_type="dock_x_precise_gentle_slow"
                 shift="0"
                 offset="0"
                 base="0.75, 0.355, 0"/>
      </RetryUntilSuccessful>
      <ForceSuccess>
        <Timeout msec="6000">
          <FirmwareMission mission_status="{x}"
                           mission_type="14"/>
        </Timeout>
      </ForceSuccess>
      <Sleep msec="1000"/>
      <RetryUntilSuccessful num_attempts="2">
        <Docking final_pose="{PrevGoal}"
                 isPureDocking="1"
                 dock_type="dock_x_precise_gentle_slow"
                 shift="0"
                 offset="0.2"
                 base="{PrevGoal}"/>
      </RetryUntilSuccessful>
      <ForceSuccess>
        <Timeout msec="6000">
          <FirmwareMission mission_status="{x}"
                           mission_type="15"/>
        </Timeout>
      </ForceSuccess>
      <Sleep msec="1000"/>
      <RetryUntilSuccessful num_attempts="2">
        <Docking final_pose="{PrevGoal}"
                 isPureDocking="0"
                 dock_type="dock_x"
                 shift="0"
                 offset="0"
                 base="1.12, 0.315, 0"/>
      </RetryUntilSuccessful>
      <ForceSuccess>
        <Timeout msec="6000">
          <FirmwareMission mission_status="{x}"
                           mission_type="12"/>
        </Timeout>
      </ForceSuccess>
      <RetryUntilSuccessful num_attempts="2">
        <Docking final_pose="{PrevGoal}"
                 isPureDocking="0"
                 dock_type="dock_x"
                 shift="0"
                 offset="0"
                 base="0.8, 0.315, 0"/>
      </RetryUntilSuccessful>
    </Sequence>
  </BehaviorTree>

  <!-- Description of Node Models (used by Groot) -->
  <TreeNodesModel>
    <Action ID="BTStarter">
      <output_port name="result"
                   type="int"/>
    </Action>
    <Action ID="Docking">
      <output_port name="final_pose"
                   type="geometry_msgs::msg::PoseStamped_&lt;std::allocator&lt;void&gt; &gt;"/>
      <input_port name="isPureDocking"
                  type="bool"/>
      <input_port name="dock_type"
                  type="std::string"/>
      <input_port name="shift"
                  type="double"/>
      <input_port name="offset"
                  type="double"/>
      <input_port name="base"
                  type="geometry_msgs::msg::PoseStamped_&lt;std::allocator&lt;void&gt; &gt;"/>
    </Action>
    <Action ID="FirmwareMission">
      <output_port name="mission_status"
                   type="int"/>
      <input_port name="mission_type"
                  type="int"/>
    </Action>
    <Decorator ID="MaterialChecker">
      <output_port name="remap_offset"
                   type="double"/>
      <output_port name="remap_shift"
                   type="double"/>
      <output_port name="remap_dock_type"
                   type="std::string"/>
      <output_port name="remap_base"
                   type="geometry_msgs::msg::PoseStamped_&lt;std::allocator&lt;void&gt; &gt;"/>
      <output_port name="remap_index"
                   type="int"/>
      <input_port name="shift"
                  type="double"/>
      <input_port name="offset"
                  type="double"/>
      <input_port name="mission_type"
                  type="std::string"/>
      <input_port name="dock_type"
                  type="std::string"/>
      <input_port name="base_index"
                  type="int"/>
    </Decorator>
    <Action ID="MySetBlackboard">
      <output_port name="new_value"
                   type="bool"/>
      <input_port name="blackboard_value"
                  type="bool"/>
      <input_port name="blackboard_key"
                  type="std::string"/>
    </Action>
  </TreeNodesModel>

</root>
