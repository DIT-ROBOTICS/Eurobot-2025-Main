<?xml version="1.0" encoding="UTF-8"?>
<root BTCPP_format="4">
  <BehaviorTree ID="BannerMission">
    <Sequence>
      <Navigation final_pose=""
                  type=""
                  goal=""/>
      <Docking final_pose=""
               useDocking=""
               offset=""
               base=""/>
      <Sleep msec=""/>
    </Sequence>
  </BehaviorTree>

  <BehaviorTree ID="FuncTest">
    <Sequence>
      <Docking final_pose="{PrevGoal}"
               useDocking="1"
               offset="-0.1"
               base="2.6, 1.3, 0"/>
      <LocReceiver rival_pose="{Rival}"
                   robot_pose="{Robot}"/>
      <Sleep msec="30000"/>
    </Sequence>
  </BehaviorTree>

  <BehaviorTree ID="MainTree">
    <Sequence>
      <Sequence>
        <BTStarter result="{STATUS}"/>
        <CamReceiver/>
      </Sequence>
      <ForceSuccess>
        <SubTree ID="MissionPointOne"
                 _autoremap="true"/>
      </ForceSuccess>
      <ForceSuccess>
        <SubTree ID="MissionPointThree"
                 _autoremap="true"/>
      </ForceSuccess>
      <ForceSuccess>
        <SubTree ID="MissionPointFour"
                 _autoremap="true"/>
      </ForceSuccess>
      <Navigation final_pose="{PrevGoal}"
                  type="0"
                  goal="0.8, 1.7, 4.71"
                  _description="go home"/>
    </Sequence>
  </BehaviorTree>

  <BehaviorTree ID="MissionPointFour">
    <Sequence>
      <Docking final_pose="{PrevGoal}"
               useDocking="0"
               offset="-1.1"
               base="0.8, 0.6, 1.57"/>
      <Sleep msec="3000"/>
      <Docking final_pose="{PrevGoal}"
               useDocking="0"
               offset="-1.1"
               base="0.8, 0.25, 3.14"
               _description="go to place the banner"/>
      <Sleep msec="3000"
             _description="place the banner"/>
      <Docking final_pose="{PrevGoal}"
               useDocking="0"
               offset="-1.1"
               base="0.8, 0.45, 1.57"
               _description="go back to do the mission"/>
      <SubTree ID="PutTwoLevels"
               FORWARD="-1.1"
               BACKWARD="1.1"
               PrevGoal="{PrevGoal}"
               _autoremap="true"/>
    </Sequence>
  </BehaviorTree>

  <BehaviorTree ID="MissionPointOne">
    <Sequence>
      <Fallback>
        <Sequence>
          <Docking final_pose="{PrevGoal}"
                   useDocking="0"
                   offset="0.1"
                   base="2.5, 1.3, 3.14"/>
        </Sequence>
        <Sequence>
          <Sleep msec="100"/>
          <Navigation final_pose="{PrevGoal}"
                      type="0"
                      goal="2.6, 1.3, 3.14"/>
        </Sequence>
      </Fallback>
      <Sleep msec="1000"
             _description="take the raw material"/>
      <Fallback>
        <Sequence>
          <Docking final_pose="{PrevGoal}"
                   useDocking="0"
                   offset="0.1"
                   base="2.5, 0.4, 0"/>
        </Sequence>
        <Sequence>
          <Sleep msec="100"/>
          <Navigation final_pose="{PrevGoal}"
                      type="0"
                      goal="2.6, 0.4, 0"/>
        </Sequence>
      </Fallback>
      <Sleep msec="1000"
             _description="take one level (2 board &amp; 2 column)"/>
      <Fallback _description="go to the placement area">
        <Sequence>
          <Docking final_pose="{PrevGoal}"
                   useDocking="0"
                   offset="0.1"
                   base="2.5, 0.9, 0"/>
        </Sequence>
        <Sequence>
          <Sleep msec="100"/>
          <Navigation final_pose="{PrevGoal}"
                      type="0"
                      goal="2.6, 0.9, 0"/>
        </Sequence>
      </Fallback>
      <PointProvider point_out2="{DISTANCE1}"
                     point_out1="{DISTANCE}"
                     point_in="0.1"/>
      <SubTree ID="PutThreeLevels"
               DISTANCE="{DISTANCE}"
               DISTANCE1="{DISTANCE1}"
               PrevGoal="{PrevGoal}"
               _autoremap="true"/>
    </Sequence>
  </BehaviorTree>

  <BehaviorTree ID="MissionPointThree">
    <Sequence>
      <Navigation final_pose="{PrevGoal}"
                  type="0"
                  goal="1.9, 0.7, 4.71"/>
      <Docking final_pose="{PrevGoal}"
               useDocking="1"
               offset="1.1"
               base="{PrevGoal}"/>
      <Sleep msec="1000"/>
      <Navigation final_pose="{PrevGoal}"
                  type="0"
                  goal="2.2, 0.5, 4.71"/>
      <Docking final_pose="{PrevGoal}"
               useDocking="1"
               offset="-1.1"
               base="{PrevGoal}"/>
      <PointProvider point_out2="{DISTANCE1}"
                     point_out1="{DISTANCE}"
                     point_in="-1.1"/>
      <SubTree ID="TakeOneLevel"
               DISTANCE="{DISTANCE}"
               DISTANCE1="{DISTANCE1}"
               PrevGoal="{PrevGoal}"
               _autoremap="true"/>
      <Navigation final_pose="{PrevGoal}"
                  type="0"
                  goal="1.25, 0.5, 4.71"/>
      <Docking final_pose="{PrevGoal}"
               useDocking="1"
               offset="-1.1"
               base="{PrevGoal}"/>
      <SubTree ID="PutThreeLevels"
               DISTANCE="{DISTANCE}"
               DISTANCE1="{DISTANCE1}"
               PrevGoal="{PrevGoal}"
               _autoremap="true"/>
    </Sequence>
  </BehaviorTree>

  <BehaviorTree ID="NavTest">
    <Sequence>
      <SubTree ID="MissionPointOne"
               _autoremap="true"/>
    </Sequence>
  </BehaviorTree>

  <BehaviorTree ID="PutThreeLevels">
    <Sequence>
      <Timeout msec="1000">
        <Sleep msec="1000"
               _description="place one level"/>
      </Timeout>
      <Docking final_pose="{PrevGoal}"
               useDocking="1"
               offset="{DISTANCE1}"
               base="{PrevGoal}"
               _description="step back"/>
      <Rotation final_pose="{PrevGoal}"
                degree="180"
                base="{PrevGoal}"/>
      <SubTree ID="PutTwoLevels"
               DISTANCE="{DISTANCE}"
               DISTANCE1="{DISTANCE1}"
               _autoremap="true"/>
      <Docking final_pose="{PrevGoal}"
               useDocking="1"
               offset="{DISTANCE1}"
               base="{PrevGoal}"
               _description="backward to free up to space for grabber to fall down"/>
      <Sleep msec="1000"
             _description="fall down the grabber"/>
      <Sleep msec="1000"
             _description="open the magnet"/>
      <Docking final_pose="{PrevGoal}"
               useDocking="1"
               offset="{DISTANCE}"
               base="{PrevGoal}"
               _description="forward to take two levels"/>
      <Sleep msec="1000"
             _description="lift the grabber"/>
      <Docking final_pose="{PrevGoal}"
               useDocking="1"
               offset="{DISTANCE}"
               base="{PrevGoal}"
               _description="forward to place two levels on one level"/>
      <Sleep msec="1000"
             _description="turn off the magnet"/>
    </Sequence>
  </BehaviorTree>

  <BehaviorTree ID="PutTwoLevels">
    <Sequence>
      <Sleep msec="1000"
             _description="put the raw material"/>
      <Docking final_pose="{PrevGoal}"
               useDocking="1"
               offset="{BACKWARD}"
               base="{PrevGoal}"
               _description="step back"/>
      <Rotation final_pose="{PrevGoal}"
                degree="180"
                base="{PrevGoal}"
                _description="rotate to face the material"/>
      <Docking final_pose="{PrevGoal}"
               useDocking="1"
               offset="{FORWARD}"
               base="{PrevGoal}"
               _description="docking to the material"/>
      <Sleep msec="1000"
             _description="take"/>
      <Docking final_pose="{PrevGoal}"
               useDocking="1"
               offset="{BACKWARD}"
               base="{PrevGoal}"
               _description="step back"/>
      <Sleep msec="1000"
             _description="lift"/>
      <Sleep msec="1000"
             _description="rotate the stage"/>
      <Docking final_pose="{PrevGoal}"
               useDocking="1"
               offset="{FORWARD}"
               base="{PrevGoal}"
               _description="go forward "/>
      <Sleep msec="1000"
             _description="place the stage"/>
      <Sleep msec="1000"
             _description="take 1 board &amp; 2 column"/>
      <Docking final_pose="{PrevGoal}"
               useDocking="1"
               offset="{BACKWARD}"
               base="{PrevGoal}"
               _description="step back"/>
      <Sleep msec="1000"
             _description="rotate the stage"/>
      <Docking final_pose="{PrevGoal}"
               useDocking="1"
               offset="{FORWARD}"
               base="{PrevGoal}"
               _description="go forward"/>
      <Sleep msec="1000"
             _description="place the material"/>
    </Sequence>
  </BehaviorTree>

  <BehaviorTree ID="TakeOneLevel">
    <Sequence>
      <Docking final_pose="{PrevGoal}"
               useDocking="1"
               offset="{DISTANCE1}"
               base="{PrevGoal}"/>
      <Sleep msec="3000"/>
      <Docking final_pose="{PrevGoal}"
               useDocking="1"
               offset="{DISTANCE1}"
               base="{PrevGoal}"/>
      <Sleep msec="3000"/>
    </Sequence>
  </BehaviorTree>

  <!-- Description of Node Models (used by Groot) -->
  <TreeNodesModel>
    <Action ID="BTStarter">
      <output_port name="result"
                   type="int"/>
    </Action>
    <Action ID="CamReceiver"/>
    <Action ID="Docking">
      <output_port name="final_pose"
                   type="geometry_msgs::msg::PoseStamped_&lt;std::allocator&lt;void&gt; &gt;"/>
      <input_port name="useDocking"
                  type="bool"/>
      <input_port name="offset"
                  type="double"/>
      <input_port name="base"
                  type="geometry_msgs::msg::PoseStamped_&lt;std::allocator&lt;void&gt; &gt;"/>
    </Action>
    <Action ID="LocReceiver">
      <output_port name="rival_pose"
                   type="geometry_msgs::msg::TwistStamped_&lt;std::allocator&lt;void&gt; &gt;"/>
      <output_port name="robot_pose"
                   type="geometry_msgs::msg::TwistStamped_&lt;std::allocator&lt;void&gt; &gt;"/>
    </Action>
    <Action ID="Navigation">
      <output_port name="final_pose"
                   type="geometry_msgs::msg::PoseStamped_&lt;std::allocator&lt;void&gt; &gt;"/>
      <input_port name="type"
                  type="int"/>
      <input_port name="goal"
                  type="geometry_msgs::msg::PoseStamped_&lt;std::allocator&lt;void&gt; &gt;"/>
    </Action>
    <Action ID="PointProvider">
      <output_port name="point_out2"
                   type="double"/>
      <output_port name="point_out1"
                   type="double"/>
      <input_port name="point_in"
                  type="double"/>
    </Action>
    <Action ID="Rotation">
      <output_port name="final_pose"
                   type="geometry_msgs::msg::PoseStamped_&lt;std::allocator&lt;void&gt; &gt;"/>
      <input_port name="degree"
                  type="double"/>
      <input_port name="base"
                  type="geometry_msgs::msg::PoseStamped_&lt;std::allocator&lt;void&gt; &gt;"/>
    </Action>
  </TreeNodesModel>

</root>
